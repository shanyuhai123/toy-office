import{d as e,i as t,c as l,r as n,o,a,w as s,b as r,n as u,e as i,M as c,p as h,f as v,g as d,v as p,h as f}from"./vendor.652d6197.js";var m=e({name:"SheetStatusBar",setup(){const e=t("coordinate");return()=>l("div",{class:"sheet-status-bar"},[l("span",{class:"current-coordinate"},[e.value]),l("input",{type:"text",class:"calc-function"},null)])}});const g=()=>((e,t=1)=>Array.from({length:e-t}).map(((e,l)=>t+l)))(91,65).map((e=>String.fromCharCode(e))),y=e=>{const t=g(),l=Math.floor(e/t.length),n=e%t.length;return`${l?t[l-1]:""}${t[n]}`},w=e=>Number(e.replace("px","")),x="#0E6409",b="#DDD",S=60,C=30,T=(e,t=!0)=>{const{offsetX:l,offsetY:n}=e,o=Math.floor(l/S)+Number(!t),a=Math.floor(n/C)+Number(!t);return{sequence:{row:o,col:a},position:{top:a*C,left:o*S}}},k=(e,l)=>{const n=t("updateCoordinate"),s=t("updateSelectedRange");let r={left:0,top:0};const u=t=>{var n;const o=null==(n=e.value)?void 0:n.getContext("2d");o&&(o.clearRect(0,0,l.width,l.height),o.strokeStyle=x,o.lineWidth=2,o.strokeRect(t.left,t.top,t.width,t.height),s(t.left,t.top,t.width,t.height))},i=((e,t=0)=>{let l;return(...n)=>{clearTimeout(l),l=setTimeout((()=>e.apply(void 0,n)),t)}})((function(e){const{position:t}=T(e,!1);r.top&&r.left&&u({left:r.left,top:r.top,width:t.left-r.left,height:t.top-r.top})}),6),c=t=>{var l;null==(l=e.value)||l.addEventListener("mousemove",i);const{position:o,sequence:a}=T(t);r=o,a.row&&a.col&&(n(y(a.row-1)+a.col),u({left:o.left,top:o.top,width:S,height:C}))},h=t=>{var l;null==(l=e.value)||l.removeEventListener("mousemove",i),r={left:0,top:0}};o((()=>{var t,l;null==(t=e.value)||t.addEventListener("mousedown",c),null==(l=e.value)||l.addEventListener("mouseup",h)})),a((()=>{var t,l;null==(t=e.value)||t.removeEventListener("mousedown",c),null==(l=e.value)||l.removeEventListener("mouseup",h)}));return{handleCellMerge:()=>{console.log("handle-cell-merge")}}};var D=e({name:"SheetCore",setup(){const e=i(null),t=n({width:-99999,height:-99999}),a=i(null),c=i(null),h=i(null),v=i(null);o((async()=>{const{width:l,height:o}=function(e){const t=n({width:0,height:0});if(e){const{clientWidth:l,clientHeight:n}=e;t.width=l,t.height=n}return t}(e.value);t.width=l,t.height=o})),((e,t)=>{s(e,(async e=>{if(!e)return;await u(),e.strokeStyle="#DDDDDD";let l=0,n=0;for(e.font="20px serif",e.textBaseline="middle",e.textAlign="center";t.width>S*l;){const n=S*l;e.moveTo(n,0),e.lineTo(n,t.height),e.stroke(),e.fillText(y(l),n+1.5*S,C/2,S),l++}for(;t.height>C*n;){const l=C*n;e.moveTo(0,l),e.lineTo(t.width,l),e.stroke(),e.fillText((n+1).toString(),S/2,l+1.5*C,S),n++}e.strokeStyle="#b2b2b2",e.beginPath(),e.moveTo(S-5,C-5),e.lineTo(S-5,7.5),e.lineTo(15,C-5),e.fillStyle="#b4b4b4",e.fill(),e.closePath()}))})(a,t),k(c,t),((e,t)=>{function l(){const l=e.value;if(!l)return;const{top:n,left:o}=l.style;l.style.top="-99999px",l.style.left="-99999px",t.value&&(t.value.font="20px serif",t.value.fillStyle="#000",t.value.textBaseline="middle",t.value.textAlign="center",t.value.fillText(l.value,w(o)+S/2,w(n)+C/2,S),l.value="",console.log(l.value))}o((()=>{var t;null==(t=e.value)||t.addEventListener("blur",l)})),r((()=>{var t;null==(t=e.value)||t.removeEventListener("blur",l)}))})(v,a);const{handleCanvasDoubleClick:d,top:p,left:f}=((e,t)=>{const l=i(((...e)=>{})),n=i(-9999),o=i(-9999);return s(e,(async e=>{await u(),l.value=e=>{const{position:t}=T(e);t.top&&t.left&&(n.value=t.top,o.value=t.left)}})),{top:n,left:o,handleCanvasDoubleClick:l}})(h);return()=>l("div",{class:"sheet-core",ref:e},[l("canvas",{class:"content-layer",width:t.width,height:t.height,ref:e=>{a.value=e&&e.getContext("2d")}},null),l("canvas",{class:"event-layer",width:t.width,height:t.height,ref:e=>{c.value=e,h.value=e&&e.getContext("2d")},onDblclick:d.value},null),l("input",{class:"canvas-input",type:"text",style:{width:S+"px",height:C+"px",top:p.value+"px",left:f.value+"px"},ref:v},null)])}}),E=e({name:"SheetToolsBar",emits:["tools-event"],setup(e,{emit:t}){const n=()=>{t("tools-event","cell-merge")};return()=>l("div",{class:"sheet-tools-bar"},[l("span",{class:"tool-item",title:"合并单元格",onClick:n},[l(c,null,null)])])}}),L=e({name:"ToySheet",setup(){const e=i(null),t=i("A1"),n=i([0,0,0,0]);h("coordinate",t),h("selectedRange",n),h("updateCoordinate",(e=>{t.value=e})),h("updateSelectedRange",((...e)=>{n.value=e}));const o=t=>{if("cell-merge"===t){const t=e.value.$el.querySelector(".content-layer").getContext("2d");t.clearRect(...n.value),t.strokeStyle=b,t.lineWidth=2,t.strokeRect(...n.value)}};return()=>l("div",{id:"toy-sheet"},[l(E,{onToolsEvent:o},null),l(m,null,null),l(D,{ref:e},null)])}});f(e({name:"App",setup(){const e=i("未命名"),t=v((()=>{const t=(l=e.value,Array.from(l).reduce(((e,t)=>(t.match(/[^\x00-\xff]/gi)?e+=2:e+=1,e)),0));var l;return 9.6*(t>10?t:10)+"px"}));return()=>l("div",{id:"sheet-app"},[l("header",{class:"toy-sheet-header"},[d(l("input",{type:"text",class:"sheet-name","onUpdate:modelValue":t=>e.value=t,style:{width:t.value},placeholder:"请输入名称"},null),[[p,e.value]])]),l(L,null,null)])}})).mount("#app");
