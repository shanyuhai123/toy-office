import{d as e,c as t,r as l,o as n,a as o,w as a,b as s,n as i,e as r,M as u,f as c,g as v,v as h,h as d}from"./vendor.99714c1a.js";var p=e({name:"ExcelStatusBar",props:{currentCoordinate:{type:String,default:"A1"}},setup:e=>()=>t("div",{class:"excel-status-bar"},[t("span",{class:"current-coordinate"},[e.currentCoordinate]),t("input",{type:"text",class:"calc-function"},null)])});const f=()=>((e,t=1)=>Array.from({length:e-t}).map(((e,l)=>t+l)))(91,65).map((e=>String.fromCharCode(e))),m=e=>{const t=f(),l=Math.floor(e/t.length),n=e%t.length;return`${l?t[l-1]:""}${t[n]}`},g=e=>Number(e.replace("px","")),x="#0E6409",w=60,y=30,b=(e,t=!0)=>{const{offsetX:l,offsetY:n}=e,o=Math.floor(l/w)+Number(!t),a=Math.floor(n/y)+Number(!t);return{sequence:{row:o,col:a},position:{top:a*y,left:o*w}}},C=(e,t,l)=>{let a={left:0,top:0};const s=l=>{var n;const o=null==(n=e.value)?void 0:n.getContext("2d");o&&(o.clearRect(0,0,t.width,t.height),o.strokeStyle=x,o.lineWidth=2,console.log(l),o.strokeRect(l.left,l.top,l.width,l.height))},i=((e,t=0)=>{let l;return(...n)=>{clearTimeout(l),l=setTimeout((()=>e.apply(void 0,n)),t)}})((function(e){const{position:t}=b(e,!1);a.top&&a.left&&s({left:a.left,top:a.top,width:t.left-a.left,height:t.top-a.top})}),6),r=t=>{var n;null==(n=e.value)||n.addEventListener("mousemove",i);const{position:o,sequence:r}=b(t);a=o,r.row&&r.col&&(l("coordinate",m(r.row-1)+r.col),s({left:o.left,top:o.top,width:w,height:y}))},u=t=>{var l;null==(l=e.value)||l.removeEventListener("mousemove",i),a={left:0,top:0}};n((()=>{var t,l;null==(t=e.value)||t.addEventListener("mousedown",r),null==(l=e.value)||l.addEventListener("mouseup",u)})),o((()=>{var t,l;null==(t=e.value)||t.removeEventListener("mousedown",r),null==(l=e.value)||l.removeEventListener("mouseup",u)}))};var E=e({name:"ExcelCore",emits:["coordinate"],setup(e,{emit:o}){const u=r(null),c=l({width:-99999,height:-99999}),v=r(null),h=r(null),d=r(null),p=r(null);n((async()=>{const{width:e,height:t}=function(e){const t=l({width:0,height:0});if(e){const{clientWidth:l,clientHeight:n}=e;t.width=l,t.height=n}return t}(u.value);c.width=e,c.height=t})),((e,t)=>{a(e,(async e=>{if(!e)return;await i(),e.strokeStyle="#DDDDDD";let l=0,n=0;for(e.font="20px serif",e.textBaseline="middle",e.textAlign="center";t.width>w*l;){const n=w*l;e.moveTo(n,0),e.lineTo(n,t.height),e.stroke(),e.fillText(m(l),n+1.5*w,y/2,w),l++}for(;t.height>y*n;){const l=y*n;e.moveTo(0,l),e.lineTo(t.width,l),e.stroke(),e.fillText((n+1).toString(),w/2,l+1.5*y,w),n++}e.strokeStyle="#b2b2b2",e.beginPath(),e.moveTo(w-5,y-5),e.lineTo(w-5,7.5),e.lineTo(15,y-5),e.fillStyle="#b4b4b4",e.fill(),e.closePath()}))})(v,c),C(h,c,o),((e,t)=>{function l(){const l=e.value;if(!l)return;const{top:n,left:o}=l.style;l.style.top="-99999px",l.style.left="-99999px",t.value&&(t.value.font="20px serif",t.value.fillStyle="#000",t.value.textBaseline="middle",t.value.textAlign="center",t.value.fillText(l.value,g(o)+w/2,g(n)+y/2,w),l.value="",console.log(l.value))}n((()=>{var t;null==(t=e.value)||t.addEventListener("blur",l)})),s((()=>{var t;null==(t=e.value)||t.removeEventListener("blur",l)}))})(p,v);const{handleCanvasDoubleClick:f,top:x,left:E}=((e,t)=>{const l=r(((...e)=>{})),n=r(-9999),o=r(-9999);return a(e,(async e=>{await i(),l.value=e=>{const{position:t}=b(e);t.top&&t.left&&(n.value=t.top,o.value=t.left)}})),{top:n,left:o,handleCanvasDoubleClick:l}})(d);return()=>t("div",{class:"excel-core",ref:u},[t("canvas",{class:"content-layer",width:c.width,height:c.height,ref:e=>{v.value=e&&e.getContext("2d")}},null),t("canvas",{class:"event-layer",width:c.width,height:c.height,ref:e=>{h.value=e,d.value=e&&e.getContext("2d")},onDblclick:f.value},null),t("input",{class:"canvas-input",type:"text",style:{width:w+"px",height:y+"px",top:x.value+"px",left:E.value+"px"},ref:p},null)])}}),T=e({name:"ExcelToolBar",setup:()=>()=>t("div",{class:"excel-tool-bar"},[t("span",{class:"tool-item",title:"合并单元格"},[t(u,{size:"1.4em"},null)])])}),k=e({name:"ExcelContainer",setup(){const e=r("A1"),l=t=>{e.value=t};return()=>t("div",{class:"excel-container"},[t(T,null,null),t(p,{currentCoordinate:e.value},null),t(E,{onCoordinate:l},null)])}});d(e({name:"App",setup(){const e=r("未命名"),l=c((()=>{const t=(l=e.value,Array.from(l).reduce(((e,t)=>(t.match(/[^\x00-\xff]/gi)?e+=2:e+=1,e)),0));var l;return 9.6*(t>10?t:10)+"px"}));return()=>t("div",{id:"toy-sheet"},[t("header",{class:"toy-sheet-header"},[v(t("input",{type:"text",class:"sheet-name","onUpdate:modelValue":t=>e.value=t,style:{width:l.value},placeholder:"请输入名称"},null),[[h,e.value]])]),t(k,null,null)])}})).mount("#app");
